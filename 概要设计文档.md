# 概要设计文档

## 1. 总体架构
- UI 层：`Maingame` 主窗口负责场景绘制、按钮与标签布局、卡牌控件管理。
- 控制层：`gamecontrol` 维护状态机（发牌/抢地主/出牌）、当前玩家和牌池，向 UI 发送信号。
- 参与者模型：基类 `player`，子类 `user`、`robot` 实现用户交互与 AI 行为（线程驱动）。
- 策略与规则：`PlayHand` 牌型识别，`Strategy` 生成 AI 出牌。
- 视听模块：`AnmationPixmap` 负责动画，`Bgmcontrol` 负责多轨音效与背景音乐。

## 2. 模块关系
- `Loadprocess` 完成加载后创建 `Maingame`。
- `Maingame` 订阅 `gamecontrol` 信号并驱动 `player` 行为；`player` 通过信号回传出牌/叫分。
- 机器人线程调用 `player::RobotGetLard`/`RobotThinkPlayhand`，内部依赖 `Strategy`。

## 3. 主要流程
- 启动/加载 → 发牌 → 抢地主 → 出牌 → 结算/重开，使用 `SetCurrentGameStatue` 控制阶段切换。

## 4. 界面结构
- 三个座位的手牌区、出牌区、头像与提示标签在 `InitGroupbtn` 中集中布置；按钮组通过 stackedWidget 切换不同阶段。

## 5. 关键数据结构
- `Card`（点数/花色）、`Cards`（QSet<Card*> 集合）提供排序、随机发牌、按值删除等操作。
- `_Playercontext` 保存每个玩家的区域、标签、最后出牌记录与翻面状态。

## 6. 关键流程说明（文字）
- 发牌：计时器驱动移动动画 → 生成地主牌面板 → 转入抢地主。
- 抢地主：`Onbet` 记录最高分，三轮后决定地主或重发牌。
- 出牌：用户/AI 触发 `GamePlayhand`，校验牌型、更新手牌与当前出牌，通知 UI。
