# 详细设计文档

## 1. Loadprocess
- 使用 QTimer 推进进度并重绘，结束后创建 `Maingame`，窗口无边框透明。

## 2. Maingame
- 构造：加载背景，初始化 `gamecontrol`、音效、卡牌面板、按钮组与倒计时。
- 状态机：`SetCurrentGameStatue` 控制发牌/抢地主/出牌的 UI、音效与地主牌展示。
- 发牌动画：`PlayHandtimer` 依次发牌，剩余 3 张生成地主牌面板，停止发牌音效并转入抢地主。
- 卡牌布局：`PendCardpos` 按水平/垂直模式放置手牌，记录出牌区并自动翻面。
- 出牌交互：`UserPlayHand` 校验牌型与能否压上家；`UserNoPlayer` 以空牌表示要不起；`AutoPlayFirstCard` 超时自动首张。
- 结算与重置：`InitEndPanel` 展示结算页，继续时重置牌堆、分数、标签与音效，再次发牌。
- 辅助：`InitPlayerTimer` 管理倒计时与提醒音；`ShowRobotHands` 在结束时亮牌；`Showanimation` 播放顺子/炸弹/飞机动画并配音。

## 3. gamecontrol
- 维护当前玩家、牌池、叫分记录与出牌记录；信号驱动 UI 与玩家状态切换。
- `GamePlayhand` 处理要不起（不更新出牌记录）与正常出牌，移除手牌、翻倍炸弹倍数、结算胜负并轮到下家。
- `Onbet` 统计最高分并在三轮后决定地主或重新洗牌发牌。

## 4. player/robot/user
- `player` 提供手牌存取、前后玩家、性别/角色、胜负与角色头像；信号用于叫分与出牌。
- `robot` 在独立线程延时调用 `RobotGetLard`（权重计算叫分）与 `RobotThinkPlayhand`（Strategy 出牌）。
- `user` 的准备阶段仅触发倒计时。

## 5. Strategy/PlayHand
- `PlayHand` 基于点数计数判断顺子、连对、飞机、炸弹、王炸等，并提供 `CanBeat` 压制规则。
- `Strategy`：首出优先长连/飞机减少手牌，其次三带、对子、单牌，最后炸弹；压制时考虑队友身份、剩余牌量与保留结构。

## 6. 视听与动画
- `Bgmcontrol` 初始化 5 路播放器，从 `conf/playList.json` 加载音轨；出牌按牌型与首出/压牌匹配音效，要不起播放固定音；抢地主音效区分首家/后手。
- `AnmationPixmap` 根据牌型切换炸弹序列帧或飞机移动动画，叫分显示对应分值贴图。

## 7. UI 控件与辅助模块
- `CardPanel`：封装单张牌的正/背面、所属玩家、点击信号。
- `MybuttonGroup`：stackedWidget 切换“开始/出牌/要不起/叫分”按钮。
- `Timecount`：倒计时显示，5 秒提醒音，超时发出信号。
- `ShowScore`/`EndPanel`：显示分数与结算结果、继续按钮。
