# 需求说明书

## 1. 系统背景与目标
- 项目定位：桌面端 Qt “欢乐斗地主” 单机游戏，完整实现发牌、叫分、出牌、计分、动画与音效，提供随时可玩的本地对局。
- 运行入口：`main.cpp` 创建 `Loadprocess` 过场界面，结束后进入 `Maingame` 主窗口，确保启动体验平滑。
- 目标：为用户提供规则完整、反馈及时、音效丰富的斗地主娱乐体验，同时保留机器人对手，保证单机可玩性。

## 2. 角色与参与者
- 玩家类型：1 名用户玩家 + 2 名机器人玩家。
- 座次与顺序：初始化时将三名玩家串成环形前后指针，固定顺时针出牌顺序。
- 角色属性：开局随机性别；叫分结束后确定 1 名地主、2 名农民。

## 3. 功能列表
- 启动与加载：无边框透明加载条，自动推进并在资源准备好后切换到主界面。
- 发牌流程：循环发牌到三家，三张底牌作为地主牌展示；包含发牌音效、移动动画与翻面控制。
- 抢地主/叫分：三名玩家轮流叫分（首家或后手），音效区分场景；三轮后根据最高分决定地主并发放底牌。
- 出牌与要不起：用户可点击/拖拽选牌并校验牌型，机器人按策略出牌；空牌代表“要不起”并触发视觉与音效提示。
- 倒计时与超时策略：轮到用户时启动倒计时，超时在自由出牌阶段自动打出第一张，否则自动选择“不出”。
- 牌型识别与比较：识别单牌、对子、三带、顺子、连对、飞机、炸弹、王炸等，并支持与上家牌型的压制判定。
- 机器人 AI：根据当前局面、队友身份与剩余手牌选择首出或压牌组合，兼顾出完手牌与保留炸弹的权衡。
- 结算与继续：按地主/农民阵营与倍数结算分数，展示结算面板、播放结果音效，可一键继续新局并累加总分。
- 视听反馈：背景、头像、提示标签、牌型动画（顺子/炸弹/飞机）、多类音效（出牌/要不起/叫分/倒计时提示）。

## 4. 用户需求（功能性）
- 交互方式：鼠标点击/拖拽选牌，右键快速出牌（已选牌），按钮操作“出牌/要不起/开始/叫分”。
- 信息提示：清晰显示手牌、出牌区域、角色头像、要不起标识、倒计时、当前阶段（发牌/叫分/出牌）。
- 反馈及时：出牌结果、压制失败、要不起、炸弹/飞机等需对应动画与音效反馈。
- 多局体验：支持连续开局，保留累计分数显示，重置上一局状态避免卡死或界面残留。

## 5. 非功能需求
- 性能：动画与音效播放流畅；发牌/出牌操作响应及时；倒计时精度为 1 秒。
- 兼容性：支持 Qt 5/6 Widgets + Multimedia，C++17；资源通过 Qt 资源系统嵌入，避免外部依赖。
- 可用性：窗口固定分辨率 1000x650，提供随机背景，界面元素布局清晰；鼠标操作区域有容差（选牌拖拽误触保护）。
- 稳定性：重新开局时应完整重置牌堆、状态与 UI，避免空指针、残留计时器导致的崩溃。

## 6. 约束条件
- 必须在桌面环境下运行，依赖音频输出设备才能听到多媒体反馈。
- 所有图片、音频、配置均来自 `res.qrc` 与 `conf/playList.json`，禁止依赖网络资源。
- 不支持网络对战，所有对手逻辑由本地 AI 线程完成。

## 7. 运行环境
- 操作系统：Windows / Linux / macOS（需对应的 Qt 多媒体后端）。
- 依赖：Qt Widgets、Qt Multimedia，编译器支持 C++17。
- 资源：随可执行一起部署 `res.qrc` 打包的图片与音频，确保 JSON 播放列表可访问。

## 8. 明确的用户需求描述（示例场景）
- 进入游戏后可点击“开始”立即发牌；若玩家未操作，机器人仍按顺序抢地主、出牌，确保单人可玩。
- 当用户牌型不合法或无法压制上家时，不应出牌，需保持提示与选牌状态。
- 当点击“要不起”或倒计时超时自动“不出”时，界面必须显示“要不起”标签并播放对应语音。
- 游戏结束后，分数结算与胜负语音应与阵营一致，点击“继续”可重置到发牌阶段，分数累加显示在计分面板。
