## 期末大作业报告（Markdown）

### 1. 选题背景
本项目选题为经典三人扑克牌游戏“斗地主”的桌面端实现。通过 Qt 框架完成 GUI、动画、音频与交互，结合简易 AI 实现人机对战，适合作为课程设计或期末大作业。

### 2. 开发环境说明
- 语言：C++17
- 框架：Qt Widgets + Qt Multimedia
- 工程：`LandFarmer.pro`
- 资源：`res.qrc` 管理的图片、音频、JSON 配置
- 运行平台：Windows

### 3. 系统功能说明
- 启动/加载界面：展示加载进度后进入主界面。
- 发牌与抢地主：随机洗牌、发牌并进行三轮叫分，最高分者成为地主获取底牌。
- 出牌与提示：支持用户点击/拖拽选牌，出牌或“不要”；机器人自动决策；倒计时与音效提示。
- 倍数与计分：根据叫分与炸弹翻倍，游戏结束时依据身份加减分。
- 结算与重开：结算面板显示胜负与分数，允许重新开始新一局。

### 4. 系统设计说明
- **架构**：三层（UI 层 `Maingame`、控制层 `gamecontrol`、领域层 `player`/`Strategy` 等）。
- **数据流**：`gamecontrol` 产生状态信号 -> `Maingame` 更新 UI；用户/机器人操作通过 `notifygrablordbet`/`notifyplayhand` 反馈给控制层。
- **状态机**：`PENDCARD`（发牌）→`GETLORD`（抢地主）→`GIVECARD`（出牌）→`USERWIN`（结算）→重新开局。
- **AI 设计**：`Strategy` 评估牌力并搜索可行牌型；`robot` 在适当时机调用策略输出叫分/出牌结果。

### 5. 技术点说明
- Qt 信号槽驱动的事件流；
- `QPainter`/`QPixmap` 渲染背景与卡牌裁剪；
- `QTimer` 控制发牌/倒计时/动画节奏；
- `PlayHand` 牌型判定与比较；
- `Strategy` 牌力评估与搜索；
- Qt 资源系统整合图片与音效。

### 6. 关键代码说明
- `Maingame::InitGamecontrol`：完成控制器初始化与信号绑定，确保 UI 能响应状态变化。【F:maingame.cpp†L57-L86】
- `gamecontrol::GamePlayhand`：集中处理出牌、要不起、倍数、结算与轮转，是核心状态流转函数。【F:gamecontrol.cpp†L176-L287】
- `gamecontrol::Onbet`：实现抢地主流程与重新发牌分支，决定是否进入出牌阶段。【F:gamecontrol.cpp†L307-L347】
- `PlayHand` / `Strategy`：提供牌型识别与 AI 决策的关键逻辑。【F:playhand.h†L21-L57】【F:strategy.h†L17-L49】

### 7. 系统运行截图说明
仓库未附运行截图，可预期界面包括：顶部/左右头像与身份标签、中央出牌区、底部用户手牌与按钮、倒计时与分数面板；背景图为 `images/background-*.png` 随机选取。

### 8. 遇到的问题与解决方案
- **要不起未显示/无音效**：`GamePlayhand` 早期未向 UI 发信号，导致 `OndisPosePlayhand` 不触发。现已在空牌分支发送 `S_gamePlayHand` 以更新标签与音效。【F:gamecontrol.cpp†L176-L205】【F:maingame.cpp†L481-L518】
- **重新开局空指针风险**：`RePlayGame` 需判空 `_Last_Cards` 后再清理，避免上一局置空导致崩溃。【F:maingame.cpp†L703-L733】
- **状态残留**：`RetCardDate` 重置牌堆、出牌记录与倒计时，防止上一局信息泄漏。【F:gamecontrol.cpp†L110-L138】

### 9. 测试说明
- 手动场景：验证发牌/抢地主/出牌/倍数/结算；
- 边界：全员不叫分、连续“要不起”、炸弹/王炸、重新开局。
- 自动化：仓库暂无，需要后续补充。

### 10. 项目总结
项目实现了完整的斗地主流程与基础 AI，界面与音效资源丰富。核心控制器 `gamecontrol` 将状态机、计分与信号统一管理，UI 通过 `Maingame` 渲染并提供用户交互。后续可扩展网络对战、持久化战绩、更多 AI 策略与单元测试。

### 11. 参考文献
- Qt 官方文档（Widgets、Multimedia、资源系统）
- 斗地主规则与常见牌型策略

### 12. 附录：大模型协作过程记录
- 阅读与梳理仓库结构，确认无数据库与网络依赖。
- 解析核心文件 `maingame.cpp`、`gamecontrol.cpp`、`player/robot/strategy/playhand` 等，提炼状态机与流程。
- 根据源码逻辑编写需求、概要设计、详细设计、测试与部署说明。
- 汇总关键问题与解决方案，形成期末报告。
